<div class="text-center" data-bind="with: step_zero_visible">
	<br/>
	<h1>Install and Configure APIne Framework</h1>
	<br/>
	<p class="lead">This utility will help you prepare and configure your new APIne project for development.</p>
	<br/>
	<div class="alert alert-info">Make sure www-data user, on Unix based server, has writing permissions on the project's directory before starting.</div>
	<br/>
	<button class="btn btn-lg btn-success" data-bind="click: $root.show_next_step">Get Started</button>
</div>

<form id="step_one" data-bind="with: step_one_visible, submit: $root.validate_step_one">
	<div class="panel panel-default">
		<div class="panel-heading">
			<h3 class="panel-title">Step 1 - Application Description</h3>
		</div>

		<div class="alert alert-block panel-info" style="margin-bottom: 0">
			Indicate some basic information about your new project. These can be shown the header of the pages generated by the framework.
		</div>

		<div class="panel-body">
			<div class="form-group">
				<label class="control-label">Name</label>
				<input class="form-control" type="text" placeholder="Application Name" data-bind="value: $root.app_name" required/>
				<span class="help-block">This is the name that will appear in the tab</span>
			</div>
			<div class="form-group">
				<label class="control-label">Author</label>
				<input class="form-control" type="text" placeholder="Author Name" data-bind="value: $root.app_auth" required/>
				<span class="help-block">Name of the Author of the application</span>
			</div>
			<div class="form-group">
				<label class="control-label">Description</label>
				<textarea class="form-control" placeholder="Application Description" data-bind="value: $root.app_desc" required></textarea>
				<span class="help-block">Describe your application briefly</span>
			</div>
		</div>
		<div class="panel-footer text-right">
			<button class="btn btn-default" role="submit">Go To Step 2</button>
		</div>
	</div>
</form>

<form id="step_two" data-bind="with: step_two_visible, submit: $root.validate_step_two">
	<div class="panel panel-default">
		<div class="panel-heading">
			<h3 class="panel-title">Step 2 - Database</h3>
		</div>

		<div class="alert alert-block panel-info">
			APIne requires the access to a SQL-like database, preferably MySQL to save session information. Provide the credentials required to connect to the database. The tables required for the framework will be created automatically.
		</div>

		<div class="error" data-bind="if: $root.invalid_step_two">
			<div class="alert alert-block alert-warning">
				<button type="button" class="close" data-dismiss="alert">&times;</button>
				<h4><strong>Warning !</strong></h4>
				<span>It is impossible to connect to database. Please make sure the database server is running and try again.</span>
			</div>
		</div>

		<div class="panel-body">

			<div class="form-group">
				<label class="control-label">Database Type</label>
				<select class="form-control" disabled data-bind="value: $root.db_type">
					<option value="mysql" selected>Relational - MySQL</option>
				</select>
			</div>
			<div class="form-group">
				<label class="control-label">Database Charset</label>
				<input class="form-control" type="text" disabled data-bind="value: $root.db_char"/>
			</div>
			<div class="form-group">
				<label class="control-label">Host</label>
				<input class="form-control" type="text" required data-bind="value: $root.db_host"/>
				<span class="help-block">Name or IP address of the server. If the database server is on the same machine as the HTTP server write "localhost" without the quotation marks.</span>
			</div>
			<div class="form-group">
				<label class="control-label">Database Name</label>
				<input class="form-control" type="text" required data-bind="value: $root.db_name" />
			</div>
			<div class="form-group">
				<label class="control-label">Database Username</label>
				<input class="form-control" type="text" required data-bind="value: $root.db_user" />
			</div>
			<div class="form-group">
				<label class="control-label">Database Password</label>
				<input class="form-control" type="password" data-bind="value: $root.db_pass" />
			</div>
		</div>
		<div class="panel-footer">
			<input class="btn btn-default pull-right" type="submit" value="Go To Step 3">
			<button class="btn btn-danger" role="button" data-bind="click: $root.show_step.bind($data, 1)">Back</button>
		</div>
	</div>
</form>

<form id="step_three" data-bind="with: step_three_visible, submit: $root.show_next_step">
	<div class="panel panel-default">
		<div class="panel-heading">
			<h3 class="panel-title">Step 3 - Localization</h3>
		</div>

		<div class="alert alert-block panel-info" style="margin-bottom: 0">
			<p>APIne comes with feature aiming to ease the process of localization of your project.</p>
			<br/>
			<p>Indicate the default timezone to use when the position of user cannot be located and the default language/locale of the project. t is possible to create more languages/locales later.</p>
		</div>

		<div class="panel-body">
			<div class="form-group">
				<label class="control-label">Default Timezone</label>
				<select class="form-control" data-bind="value: $root.loc_time" required>
					<option selected disabled>Choose a Timezone</option>
					{loop:timezones}
					<optgroup label="{name}">
						{loop:zones}
						<option value="{code}">{name}</option>
						{endloop}
					</optgroup>
					{endloop}
				</select>
				<span class="help-block">This will be the timezone used when it is impossible to locate the visitor</span>
			</div>
			<div class="form-group">
				<label class="control-label">Default Language and Locale</label>
				<select class="form-control" data-bind="value: $root.loc_lang" required>
					<option selected disabled>Choose a Language</option>
					{loop:locales}
					<option value="{code}">{name}</option>
					{endloop}
				</select>
			</div>
		</div>
		<div class="panel-footer">
			<button class="btn btn-default pull-right" role="submit">Go To Step 4</button>
			<button class="btn btn-danger" role="button" data-bind="click: $root.show_step.bind($data, 2)">Back</button>
		</div>
	</div>
</form>

<form id="step_four" data-bind="with: step_four_visible, submit: $root.validate_step_four">
	<div class="panel panel-default">
		<div class="panel-heading">
			<h3 class="panel-title">Step 4 - User Creation</h3>
		</div>

		<div class="error" data-bind="if: $root.invalid_step_four">
			<div class="alert alert-block alert-warning">
				<button type="button" class="close" data-dismiss="alert">&times;</button>
				<h4><strong>Warning !</strong></h4>
				<span>Make sure your password is OK and try again.</span>
			</div>
		</div>

		<div class="panel-body">
			<div class="form-group">
				<label class="control-label">Create a first user?</label>
				<select class="form-control" data-bind="value: $root.user" required>
					<option value="1">Yes</option>
					<option value="0" selected>No</option>
				</select>
				<span class="help-block">Having a first user already eases the process to testing when starting a new project.</span>
			</div>
			<div data-bind="if: $root.user() == 1">
				<div class="form-group">
					<label class="control-label">Username</label>
					<input class="form-control" type="text" placeholder="Username" data-bind="value: $root.user_name" required/>
				</div>
				<div class="form-group">
					<label class="control-label">Email Address</label>
					<input class="form-control" type="email" placeholder="E-mail" data-bind="value: $root.user_email" required/>
				</div>
				<div class="form-group">
					<label class="control-label">User Type</label>
					<select class="form-control" data-bind="value: $root.user_type" required>
						<option value="65">Normal User</option>
						<option value="77">Administrator</option>
						<option value="10">Deleted User</option>
					</select>
				</div>
				<div class="form-group">
					<label class="control-label">Password</label>
					<input class="form-control" type="password" placeholder="Password" data-bind="value: $root.user_pass" required/>
				</div>
				<div class="form-group">
					<label class="control-label">Confirm Password</label>
					<input class="form-control" type="password" placeholder="Password" data-bind="value: $root.user_pass2" required/>
				</div>
			</div>
		</div>
		<div class="panel-footer">
			<input class="btn btn-default pull-right" type="submit" value="Go To Step 5">
			<button class="btn btn-danger" role="button" data-bind="click: $root.show_step.bind($data, 3)">Back</button>
		</div>
	</div>
</form>

<form id="step_five" data-bind="with: step_five_visible, submit: $root.show_next_step">
	<div class="panel panel-default">
		<div class="panel-heading">
			<h3 class="panel-title">Step 5 - Assets Generation</h3>
		</div>

		<div class="alert alert-block panel-info" style="margin-bottom: 0">
			<p>This installer can generate some directories and files to assist you in the development of your project.</p>
		</div>

		<div class="panel-body">

			<div class="row">
				<div class="col-md-6">
					<div class="form-group">
						<label class="control-label">Would you like to generate the directory structure for your project?</label>
						<select class="form-control" data-bind="value: $root.generate_folders" required>
							<option value="1">Yes</option>
							<option value="0">No</option>
						</select>
					</div>

					<!-- ko if: $root.generate_folders_bool() -->
					<div class="form-group">
						<label class="control-label">Would you like to generate a base for your project?</label>
						<select class="form-control" data-bind="value: $root.generate_files" required>
							<option value="1">Yes</option>
							<option value="0">No</option>
						</select>
					</div>
					<!-- /ko -->
				</div>
				<div class="col-md-6">
					<p>The following folders and files will be created if they do not exist already :</p>
					<ul>
						<!-- ko if: $root.generate_folders_bool() -->
						<li>controllers/
							<!-- ko if: $root.generate_files_bool() -->
							<ul>
								<li>HomeController.php</li>
								<li>SessionController.php</li>
							</ul>
							<!-- /ko -->
						</li>
						<li>modules/</li>
						<li>resources/
							<ul>
								<li>languages/
									<ul>
										<li data-bind="text: $root.loc_lang() + '.json'"></li>
									</ul>
								</li>
								<li>public/
									<ul>
										<li>assets/</li>
										<li>css/</li>
										<li>scripts</li>
									</ul>
								</li>
							</ul>
						</li>
						<li>views/
							<!-- ko if: $root.generate_files_bool() -->
							<ul>
								<li>home.twig</li>
								<li>login.twig</li>
								<li>register.twig</li>
							</ul>
							<!-- /ko -->
						</li>
						<!-- /ko -->
						<li>.htaccess</li>
						<li>config.ini</li>
						<li>composer.json</li>
						<li>composer.phar</li>
						<li>routes.json</li>
						<!-- ko ifnot: $root.generate_folders_bool() -->
						<li data-bind="text: $root.loc_lang() + '.json'"></li>
						<!-- /ko -->
					</ul>
				</div>
			</div>
		</div>
		<div class="panel-footer">
			<button class="btn btn-default pull-right" role="submit">Go To Step 6</button>
			<button class="btn btn-danger" role="button" data-bind="click: $root.show_step.bind($data, 4)">Back</button>
		</div>
	</div>
</form>

<div id="step_six" data-bind="with: step_six_visible">
	<div class="panel panel-default">
		<div class="panel-heading">
			<h3 class="panel-title">Step 6 - Confirmation</h3>
		</div>
		<div class="panel-body">
			<p class="lead">The following settings will be applied to your new application.</p>
			<div class="alert alert-info">Make sure www-data user has writting permissions on the project's directory.</div>
			<h4>Application :</h4>
			<dl class="dl-horizontal">
				<dt>Name</dt>
				<dd data-bind="text: $root.app_name"></dd>
				<dt>Author</dt>
				<dd data-bind="text: $root.app_auth"></dd>
				<dt>Description</dt>
				<dd data-bind="text: $root.app_desc"></dd>
			</dl>
			<h4>Database :</h4>
			<dl class="dl-horizontal">
				<dt>Host</dt>
				<dd data-bind="text: $root.db_host"></dd>
				<dt>Database Type</dt>
				<dd data-bind="text: $root.db_type"></dd>
				<dt>Database name</dt>
				<dd data-bind="text: $root.db_name"></dd>
				<dt>Database Charset</dt>
				<dd data-bind="text: $root.db_char"></dd>
				<dt>Username</dt>
				<dd data-bind="text: $root.db_user"></dd>
				<dt>Password</dt>
				<dd data-bind="text: $root.db_pass"></dd>
			</dl>
			<h4>Localization :</h4>
			<dl class="dl-horizontal">
				<dt>Default Timezone</dt>
				<dd data-bind="text: $root.loc_time"></dd>
				<dt>Default Locale</dt>
				<dd data-bind="text: $root.loc_lang"></dd>
			</dl>
			<!--<div data-bind="if: $root.email() == 1">
				<h4>Email Server :</h4>
				<dl class="dl-horizontal">
					<dt>Host</dt>
					<dd data-bind="text: $root.email_host"></dd>
					<dt>Port</dt>
					<dd data-bind="text: $root.email_port"></dd>
					<dt>Protocol</dt>
					<dd data-bind="text: $root.email_prot"></dd>
					<dt>SMTP Authentication</dt>
					<dd data-bind="text: $root.email_auth_text"></dd>
					<div data-bind="if: $root.email_auth_bool">
						<dt>SMTP Username</dt>
						<dd data-bind="text: $root.email_user"></dd>
						<dt>SMTP Password</dt>
						<dd>*****</dd>
					</div>
					<dt>Sender Name</dt>
					<dd data-bind="text: $root.email_name"></dd>
					<dt>Sender Address</dt>
					<dd data-bind="text: $root.email_addr"></dd>
				</dl>
			</div>-->
			<h4>Create First User</h4>
				<dl class="dl-horizontal">
					<!-- ko if: $root.user() == 1 -->
					<dt>Username</dt>
					<dd data-bind="text: $root.user_name"></dd>
					<dt>Email Address</dt>
					<dd data-bind="text: $root.user_email"></dd>
					<dt>Password</dt>
					<dd data-bind="text: $root.user_pass"></dd>
					<dt>Type</dt>
					<dd data-bind="text: $root.user_type_text"></dd>
					<!-- /ko -->
					<!-- ko ifnot: $root.user() == 1 -->
					<dt>Create a user?</dt>
					<dd>No</dd>
					<!-- /ko -->
				</dl>
			<h4>Assets :</h4>
			<dl class="dl-horizontal">
				<dt>Generate Basic<br>Project Structure ?</dt>
				<dd data-bind="text: $root.generate_folders_text"></dd>
				<dt>Generate Base<br>Project Files ?</dt>
				<dd data-bind="text: $root.generate_files_text"></dd>
			</dl>
		</div>
		<div class="panel-footer">
			<button class="btn btn-default pull-right" role="button" data-bind="click: $root.apply_settings">Apply configuration &amp; Install</button>
			<button class="btn btn-danger" role="button" data-bind="click: $root.show_step.bind($data, 5)">Back</button>
		</div>
	</div>
</div>
<div id="step_finish" class="text-center" data-bind="with: step_finish_visible">
	<br/>
	<div class="jumbotron">
		<h1>Configuration Completed!!</h1>
		<h2>Your installation of APIne Framework is ready to work.</h2>
	</div>
	<br/>

	<p>You can now install Composer packages using the bundled composer binary with the following command :</p>
	<p><code>$ php composer.phar install</code></p>
	<p><strong>OR</strong></p>
	<p>You can notify APIne not to expect to find Composer packages by adding this line before the run statement in <code>index.php</code>:</p>
	<p><code>$apine->use_composer(false);</code></p>
</div>
<div class="text-center" data-bind="with: step_error_visible">
	<br/>
	<div class="jumbotron">
		<h1>Configuration Failed!!</h1>
		<h2>Installation of APIne Framework has failed.</h2>
	</div>
	<br/>

	<h3>The installation may have failed because:</h3>
	<p>PHP did not have rights to write on the project's directory.</p>
	<p><strong>OR</strong></p>
	<p>The database user did not have permissions to create tables on the database.</p>
</div>